<?xml version="1.0" ?>
<spellcast xmlns:xi = "http://www.w3.org/2001/XInclude">
  <guildwork character="Aniyah" server="Sylph" description="Feary's WHM Spellcast" job="WHM"/>
  <config RequireVersion="2.45" ShowGearSwaps="false" Debug="false" ShowSpellInfo="false"/>
  <variables clear="True">
    <!-- Aniyah -->
    <!-- Auto Echo Drops -->
    <var name="AutoEchoDrops">1</var>
    <!-- Auto Holy Waters - doesnt work -->
    <var name="AutoHolyWater">1</var>
    <!-- Printchat -->
    <var name="Printchat">1</var>
    <!--AutoMacroset set 0 for Off-->
    <var name="AutoMacroset">1</var>
    <!-- Cure bot - change Cure based on Target HP.-->
    <var name="CureBot">1</var>
    <!-- Evil Spell - Prevent cure4-->
    <var name="EvilSpell">1</var>
    <!-- Auto -->
    <var name="AutoSolace">0</var>
    <var name="AutoEsuna">0</var>
    <var name="AutoMisery">0</var>
    <var name="AutoRefresh">0</var>
    <!-- Cure Clogs-->
    <var name="$CureClogs">0</var>
    <!-- use Medicine ring or not? set to 0 if you do not have it or dangerous location -->
    <var name="Ring">0</var>
    <var name="BLMRingHP">743</var>
    <var name="RDMRingHP">784</var>
    <var name="SCHRingHP">763</var>
    <var name="SMNRingHP">720</var>
    <!-- Lock Weapon -->
    <var name="Club">Warp Cudgel|Molva Maul|Stenz|Rageblow|Culacula</var>
    <var name="Staff">Celeritas Pole|Teiwaz</var>   
    <!-- Elemental Staves-->
    <var name="CureStaff">Arka IV</var>
    <var name="RestingStaff">Iridal Staff</var>
    <var name="PDTStaff">Earth Staff</var>
    <var name="IceStaff">Iridal Staff</var>
    <var name="DarkStaff">Iridal Staff</var>
    <var name="ThunderStaff">Iridal Staff</var>
    <var name="LightStaff">Iridal Staff</var>
    <var name="WindStaff">Iridal Staff</var>
    <var name="FireStaff">Iridal Staff</var>
    <var name="EarthStaff">Iridal Staff</var>
    <var name="WaterStaff">Iridal Staff</var>
    <!-- Elemental Obis-->
    <var name="obidark">0</var> 
    <var name="obilight">0</var>
    <var name="obithunder">1</var>
    <var name="obiice">1</var>
    <var name="obifire">0</var>
    <var name="obiwind">0</var>
    <var name="obiwater">0</var>
    <var name="obiearth">0</var>
  </variables>
  <sets>
    <group name="WHM" default="yes">
      <set name="MiscGearCollector" load="yes">

      </set>
      <set name="Town" baseset="PDT" load="yes">
        <main>$CureStaff</main>
        <head>Orison Cap +2</head>
        <body>Orison Bliaud +2</body>
        <hands>orison mitts +2</hands>
        <legs>Orsn. pantaln. +2</legs>
        <feet>Orsn. Duckbills +2</feet>
        <back>Oretania's cape</back>
      </set>
      <!-- PDT and Movment speed -->
      <set name="Idle|PDT" baseset="Standard" load="yes">
        <sub>Pax Grip</sub>
        <neck>Twilight Torque</neck>
        <body>Orison Bliaud +2</body>
        <hands>Serpentes Cuffs</hands>
        <back>Cheviot Cape</back>
        <lring>Dark Ring</lring>        
      </set>
      <set name="Standard" load="yes">
        <ammo>Incantor Stone</ammo>
        <main>$PDTStaff</main>        
        <head>orison cap +2</head>
        <neck>Orison Locket</neck>
        <body>Orison Bliaud +2</body>
        <hands>Blessed Mitts</hands>
        <legs>Orsn. pantaln. +2</legs>
        <feet>Orsn. Duckbills +2</feet>
        <waist>Austerity Belt</waist>
        <back>Aslan Cape</back>
        <lring>Dark Ring</lring>
        <rring>Dark Ring</rring>
        <lear>Loquac. Earring</lear>
        <rear>Orison Earring</rear>
      </set>
      <set name="Resting" BaseSet="Standard" load="yes">     
        <ammo>Clarus Stone</ammo>
        <body>Orison Bliaud +2</body>
        <neck>Eidolon Pendant</neck>
        <hands>Serpentes Cuffs</hands>
        <legs>Sagacity Lappas</legs>
        <waist>Austerity Belt</waist>
        <back>Felicitas Cape</back>
        <feet>Avocat Pigaches</feet>
        <lear>Relaxing Earring</lear>
        <rear>Antivenom Earring</rear>        
      </set>
      <set name="Haste|Fastcast" BaseSet="Standard" load="yes">
        <ammo>Incantor Stone</ammo>
        <head>Walahra Turban</head>
        <neck>Orison Locket</neck>
        <hands>Blessed Mitts</hands>
        <legs>Blessed Trousers</legs>
        <feet>Blessed Pumps</feet>
        <lear>Loquac. Earring</lear>
        <waist>Headlong Belt</waist>
      </set>
      <set name="Devotion" BaseSet="Standard" load="yes">
        <lring lock="true">Bloodbead Ring</lring>
      </set>
      <set name="MinusHP">
        <head>Zenith Crown</head>
        <neck>Morgana's Choker</neck>
        <body>Dalmatica</body>
        <hands>Zenith Mitts</hands>
        <legs>Zenith Slacks</legs>
        <waist>Penitent's Rope</waist>
        <feet>Zenith Pumps</feet>
      </set>
      <!-- Healing Skill = Na Spells -->
      <set name="Healing" BaseSet="Standard" load="yes">
        <main>Beneficus</main>
        <head>orison cap +2</head>
        <neck>Orison Locket</neck>
        <body>Orison Bliaud +2</body>
        <hands>Healer's Mitts</hands>
        <legs>Orsn. pantaln. +2</legs>
        <rring>Sirona's Ring</rring>
        <back>Altruistic Cape</back>
      </set>
      <!-- Cure potancy -->
      <set name="Cure" BaseSet="Standard" load="yes">
        <ammo>Incantor Stone</ammo>
        <main>$CureStaff</main>        
        <head>Orison cap +2</head>
        <neck>Orison Locket</neck>
        <body>Heka's Kalasiris</body>
        <hands>Augur's Gloves</hands>
        <legs>Orsn. pantaln. +2</legs>
        <feet>Orsn. Duckbills +2</feet>
        <lring>Solemn ring</lring>
        <rring>Sirona's ring</rring>
        <waist>Cleric's Belt</waist>
        <back>Oretania's Cape</back>
        <lear>Loquac. Earring</lear>
        <rear>Orison Earring</rear>
        <sub>Pax Grip</sub>
      </set>
      <!-- Cure 5 set - Emnity -->
      <set name="CV" BaseSet="Cure" load="yes"/>
      <set name="Curaga" baseset="Cure">
        <body>Heka's Kalasiris</body>
      </set>
      <set name="DarkMagic" BaseSet="Standard" load="yes" />
      <set name="Enhancing" BaseSet="Standard" load="yes">
        <main>Beneficus</main>
        <hands>Augur's Gloves</hands>
        <feet>Orsn. Duckbills +2</feet>
      </set>
      <set name="Barspells" baseset="Enhancing" load="yes">
        <head>orison cap +2</head>
        <body>Orison Bliaud +2</body>
        <hands>orison mitts +2</hands>
        <legs>Orsn. pantaln. +2</legs>
        <feet>Orsn. Duckbills +2</feet>
      </set>
      <set name="Regen" baseset="Enhancing" load="yes">
        <body>Cleric's Briault</body>
        <hands>orison mitts +2</hands>
      </set>
      <set name="Stoneskin" baseset="Enhancing" load="yes"/>
      <set name="Divine" BaseSet="Standard" load="yes">
        <main>$WaterStaff</main>
        <body>Praeco Doublet</body>
        <head>Elite Beret</head>
        <legs>Healer's Pantaln.</legs>
        <feet>Healer's duckbills</feet>
        <rring>Omega Ring</rring>
        <hands>Teal Cuffs</hands>
      </set>
      <set name="Banish" BaseSet="Divine" load="yes">
        <lear>Moldavite Earring</lear>
        <rear>Hecate's Earring</rear>
        <hands>Zenith Mitts</hands>
        <back>Searing Cape</back>
      </set>
      <set name="Enfeeb" BaseSet="Standard" load="yes">
        <main>$%Elementstaff</main>
        <head>Elite Beret</head>
        <body>Healer's Briault</body>
        <hands>Cleric's Mitts</hands>
        <legs>Sagacity lappas</legs>
        <lring>Balrahn's Ring</lring>
        <rring>Omega Ring</rring>        
        <feet>Rostrum Pumps</feet>
        <waist>Penitent's Rope</waist>
      </set>
      <set name="Enfeeb-WhiteMagic|MND" BaseSet="Enfeeb" load="yes">
        <head>orison cap +2</head>
        <waist>Cleric's Belt</waist>
      </set>
      <set name="Enfeeb-BlackMagic|INT" BaseSet="Enfeeb" load="yes">
        <legs>Teal Slops</legs>
        <lear>Morion Earring</lear>
        <ammo>Snow Sachet</ammo>
      </set>      
      <!-- DD WHM Sets-->
      <set name="Melee|TP" baseset="Haste">
        <head>Walahra Turban</head>
        <hands>Blessed Mitts</hands>
        <legs>Blessed Trousers</legs>
        <feet>Blessed Pumps</feet>
        <lear>Brutal Earring</lear>
        <waist>Headlong Belt</waist>
      </set>
      <set name="WS" baseset="TP">
        <lring>Rajas Ring</lring>
        <rring>Spiral Ring</rring>
      </set>
      <!-- Club -->
      <set name="Skullbreaker|Judgment" baseset="ws"/>
      <set name="Shining Strike|Seraph Strike|Flash Nova" baseset="MAB"/>
      <set name="Hexa Strike" baseset="WS">
        <waist store="sack">Light Belt</waist>
      </set>
      <set name="Black Halo|True Strike" baseset="WS">
        <waist store="sack">Breeze Belt</waist>
      </set>
      <!-- Staff -->
      <set name="Shell Crusher|Full Swing|Heavy Swing|Spirit Taker|Retribution" baseset="ws"/>
      <set name="Rock Crusher|Earth Crusher|Sunburst|Cataclysm" baseset="MAB">
        <waist>Shadow Belt</waist>
      </set>
      
    </group>
  </sets>
  <rules>
    <if Spell="Teleport*|Recall*|Warp*|Escape">
      <command when="Precast">input /p Casting %Spell </command>
      <return/>
    </if>
    <!-- Brewing -->
    <if mode="or" buffactive="Transcendency" advanced='"$brew"=="1"'>
      <addtochat color="121">Brew Mode</addtochat>
      <disable slot="main|sub|range" />
      <if status="engaged">
        <equip when="engaged|AfterCast" set="TP"/>
      </if>
      <else>
        <equip when="idle|aftercast" set="TP" />
      </else>
      <if type="Weaponskill">
        <!-- WeaponSkill-->
        <if type="Weaponskill">
          <if TPGT="99">
            <if advanced="%SpellTargetDistance &lt; 4">
              <CastDelay Delay=".5"/>
              <if spell="Earth Crusher|Rock Crusher">
                <equip when="precast" set="%Spell">
                  <main>$EarthStaff</main>
                </equip>
              </if>
              <elseif spell="Catacylsm">
                <equip when="precast" set="%Spell">
                  <main>$Darkstaff</main>
                </equip>
              </elseif>
              <else>
                <equip when="precast" set="%Spell"/>
              </else>            
            </if>
            <else>
              <cancelspell/>
              <addtochat color="121">%SpellTargetName is too far.</addtochat>
              <Return/>
            </else>
          </if>
          <else>
            <cancelspell/>
            <addtochat color="121">You don't have enough TP for that</addtochat>
            <Return/>
          </else>
        </if>       
      </if>
      <elseif type="*magic">
        <equip when="precast" set="MAB"/>
      </elseif>
      <Return/>
    </if>
    <!-- Auto set-->   
    <!-- Engaged -->
    <if equipmain="$Club">
      <disable slot="main|sub|range" />
      <equip when="resting" set="resting"/>
      <if status="Engaged">
        <equip when="Engaged|Aftercast" set="TP" />
      </if>
      <!-- Not Engaged -->
      <else>
        <equip when="Idle|Aftercast" set="PDT" />
      </else>      
    </if>
    <elseif equipmain="$Staff">
      <disable slot="main|sub|range" />
      <if status="Engaged">
        <equip when="Engaged|Aftercast" set="TP">
          <sub>Pole Grip</sub>
        </equip>
      </if>
      <!-- Not Engaged -->
      <else>
        <equip when="Idle|Aftercast" set="PDT" />
      </else>
      <equip when="resting" set="resting"/>
    </elseif>    
    <else>
      <enable slot="main|sub|range" />
      <equip when="resting" set="resting">
        <main>$RestingStaff</main>
        <sub>Pax Grip</sub>
      </equip>
      <equip when="Idle|Aftercast" set="PDT">
        <main>$PDTStaff</main>
        <sub>Pax Grip</sub>
      </equip>
    </else>
    <!-- FastCast gear -->
    <equip when="precast">
      <ammo>Incantor Stone</ammo>
      <neck lock="true">Orison Locket</neck>
      <lear lock="true">Loquac. Earring</lear>
      <feet lock="true">Rostrum Pumps</feet>
    </equip>
    <!-- Healing Magic-->
    <if Skill="HealingMagic">
      <!-- Cure Spells -->
      <if spell="Cur*">
        <equip when="precast" set="cure">
          <main>$Curestaff</main>
        </equip>
        <if spell="Cure V">
          <equip when="midcast" Set="CV" />
        </if>
        <else>
          <equip when="midcast" Set="Cure" />
        </else>
        <!-- Light Obi -->
        <if advanced = '("%spellelement" = "%weatherelement" or "%spellelement" = "%dayelement") and "$%spellelementobi" = "1"'>
          <if element = "light">
            <equip when = "midcast">
              <waist lock = "yes">korin obi</waist>
            </equip>
          </if>
        </if>
        <!-- Cure Clogs-->
        <if advanced='"$CureClogs"=="1"'>
          <equip when="Precast">
            <feet lock="true">Cure Clogs</feet>
          </equip>
        </if>
        <!-- Medicine Ring-->
        <if advanced='$Ring == 1'>
          <!-- make sure we have an HP variable set for current subjob -->
          <if Advanced='"$%SubJobRingHP" !="$%SubJobRingHP"'>
            <if Advanced='%HP &gt; $%SubJobRingHP'>
              <!-- if you have too much HP at the time of casting, equip minus hp -->
              <equip set="MinusHP" />
            </if>
          </if>
          <else>
            <!-- if no HP amount is specified for the current subjob, just always equip minushp as precast -->
            <equip set="MinusHP" />
          </else>
          <equip when="midcast">
            <rring>Medicine Ring</rring>
          </equip>
        </if>
        <!-- Makes Sure Solace is Up for cures-->
        <if advanced='"$AutoSolace"=="1"'>
          <if notbuffactive="Afflatus Solace">
            <changespell spell="Afflatus Solace"/>
            <changetarget target="&lt;me&gt;"/>
          </if>
        </if>
        <elseif notbuffactive="Afflatus Solace">
          <addtochat color="121">You Don't have Solace</addtochat>
        </elseif>
        <else>
          <if advanced='"$Evilspell"=="1"'>
            <!-- Evil Spell -->
            <if Spell="Cure IV">
              <changespell Spell="Cure V" />
            </if>
            <elseif Spell="Curaga III">
              <changespell Spell="Curaga IV" />
            </elseif>
          </if>
          <!-- Cure MP Based Reduction -->
          <if NotBuffActive="Light Arts">
            <if Spell="Cure VI" MPLT="227">
              <changespell Spell="Cure V" />
            </if>
            <elseif Spell="Cure V" MPLT="135">
              <changespell Spell="Cure III" />
            </elseif>
            <elseif Spell="Cure III" MPLT="46">
              <changespell Spell="Cure II" />
            </elseif>
            <elseif Spell="Cure II" MPLT="24">
              <cancelspell />
            </elseif>
            <elseif spell="Cura II" MPLT="45">
              <changespell Spell="Cura" />
            </elseif>
            <elseif spell="Cura" MPLT="30">
              <changespell Spell="Curaga II" />
            </elseif>
            <elseif spell="Curaga IV" MPLT="260">
              <changespell Spell="Curaga III" />
            </elseif>
            <elseif spell="Curaga III" MPLT="180">
              <changespell Spell="Curaga II" />
            </elseif>
            <elseif spell="Curaga II" MPLT="120">
              <changespell Spell="Curaga" />
            </elseif>
            <elseif spell="Curaga" MPLT="60">
              <cancelspell />
            </elseif>
          </if>
          <!-- Cure bot-->
          <if advanced='"$CureBot"=="1"'>
            <!-- Abyssea Cure HP Base Reduction -->
            <if zone="Abyssea*">
              <if spell="Cure VI">
                <if SpellTargetHPPGT="30" SpellTargetHPPLT="50">
                  <changespell spell="Cure V"/>
                </if>
                <elseif SpellTargetHPPGT="50" SpellTargetHPPLT="70">
                  <changespell spell="Cure V"/>
                </elseif>
                <elseif SpellTargetHPPGT="70" SpellTargetHPPLT="80">
                  <changespell spell="Cure IV"/>
                </elseif>
                <elseif SpellTargetHPPGT="80" SpellTargetHPPLT="90">
                  <changespell spell="Cure III"/>
                </elseif>
                <elseif SpellTargetHPPGT="90" SpellTargetHPPLT="95">
                  <changespell spell="Cure II"/>
                </elseif>
                <elseif SpellTargetHPPGT="95">
                  <changespell spell="Cure"/>
                </elseif>
              </if>
            </if>
            <!-- Cure HP Base Reduction -->
            <else>
              <if spell="Cure VI">
                <if SpellTargetHPPGT="30" SpellTargetHPPLT="50">
                  <changespell spell="Cure V"/>
                </if>
                <elseif SpellTargetHPPGT="50" SpellTargetHPPLT="80">
                  <changespell spell="Cure III"/>
                </elseif>
                <elseif SpellTargetHPPGT="80" SpellTargetHPPLT="90">
                  <changespell spell="Cure II"/>
                </elseif>
                <elseif SpellTargetHPPGT="90" SpellTargetHPPLT="95">
                  <changespell spell="Cure"/>
                </elseif>
                <elseif SpellTargetHPPGT="95">
                  <changespell spell="Regen IV"/>
                </elseif>
              </if>
            </else>
          </if>
          <!-- Cura -->
          <if spell="Cura*">
            <if advanced='"%Spelltargetname"=="&lt;me&gt;"'>
              <!-- Print chat -->
              <if advanced='"$Printchat"=="1"'>
                <cmd when="midcast">input /p Casting %Spell @ [%Spelltargetname]</cmd>
              </if>
              <!-- Makes sure Misery is active for esuna-->
              <if advanced='"$AutoMisery"=="1"'>
                <if spell="Cura" notbuffactive="Afflatus Misery">
                  <changespell spell="Afflatus Misery"/>
                  <cmd when="aftercast">wait 3;input /ma "Curaga II" &lt;me&gt;</cmd>
                  <changetarget target="&lt;me&gt;" />
                </if>
                <elseif spell="Cura II" notbuffactive="Afflatus Misery">
                  <changespell spell="Afflatus Misery"/>
                  <cmd when="aftercast">wait 3;input /ma "Curaga" &lt;me&gt;</cmd>
                  <changetarget target="&lt;me&gt;" />
                </elseif>
              </if>
            </if>
          </if>
        </else>
      </if>
      <!-- Raise -->
      <elseif Spell="Raise*">
        <if advanced='"$Printchat"=="1"'>
          <if partycountgt="2">
            <if Area="Dynamis*|Hazhalm*" notspelltarget="Derion|Feary|Aniyah">
              <command when="midcast">input /l Casting %spell on [%spelltarget]</command>
            </if>
            <else>
              <command when="midcast">input /p Casting %spell on [%spelltarget]</command>
            </else>
          </if>
        </if>
      </elseif>
      <!-- Na spells-->
      <else>
        <!-- Healing Skill Gear -->
        <equip when="midcast" set="Healing"/>
        <!-- Haste gear for all other spells-->
        <equip when="Precast" set="Haste"/>
        <if spell="Erase|*na">
          <if advanced='"$Printchat"=="1"'>
            <if notspelltarget="Feary|Aniyah|Derion">
              <cmd when="midcast">input /p Casting %Spell @ [%Spelltargetname]</cmd>
            </if>
          </if>
          <!-- Cursna Needs Skill gear-->
          <if spell="Cursna">
            <equip when="Precast|Midcast" set="Healing">
              <legs>Cleric's Pantaln.</legs>
            </equip>
          </if>
          <!-- Misery Active-->
          <if advanced='"AutoMisery"=="1"'>
            <!-- Auto Esuna -->
            <if Partycountgt="1" buffactive="Afflatus Misery" notbuffactive="Accession">
              <if spell="Paralyna" buffactive="Paralysis">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </if>
              <elseif spell="Poisona" buffactive="poison">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </elseif>
              <elseif spell="Blindna" buffactive="Blindness">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </elseif>
              <elseif spell="Viruna" buffactive="disease">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </elseif>
              <elseif spell="Erase" buffactive="bind|weight|*Down">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </elseif>
              <elseif spell="Haste" buffactive="Slow">
                <changespell spell="Esuna"/>
                <changetarget target="&lt;stpc&gt;" />
                <addtochat when="Precast" color="121">Changed to Esuna Cast on yourself when ready.</addtochat>
              </elseif>
            </if>
          </if>
        </if>
        <!-- Makes sure Misery is active for esuna-->
        <if advanced='"$AutoMisery"=="1"'>
          <!-- Makes sure Misery is active for esuna-->
          <if spell="Esuna" notbuffactive="Afflatus Misery">
            <changespell spell="Afflatus Misery"/>
            <cmd when="aftercast">wait 3;input /ma "Esuna"</cmd>
            <changetarget target="&lt;stpc&gt;" />
          </if>
          <if spell="Auspice" notbuffactive="Afflatus Misery">
            <changespell spell="Afflatus Misery"/>
            <cmd when="aftercast">wait 3;input /ma "Auspice"</cmd>
            <changetarget target="&lt;stpc&gt;" />
          </if>
        </if>
      </else>
    </if>
    <!-- Enhancing Magic-->
    <elseif Skill="EnhancingMagic">
      <if Spell="Bar*">
        <equip when="precast|midcast" set="Barspells"/>
      </if>
      <elseif Spell="Regen*">
        <equip when="precast|midcast" set="Regen"/>
        <if spell="Regen IV" mplt="82">
          <changespell>Regen III</changespell>
        </if>
        <elseif spell="Regen III" mplt="64">
          <changespell>Regen II</changespell>
        </elseif>
        <elseif spell="Regen II" mplt="36">
          <changespell>Regen</changespell>
        </elseif>
      </elseif>
      <elseif Spell="Erase">
        <equip when="precast|midcast" set="Enhancing">
          <head>orison cap +2</head>
        </equip>
      </elseif>     
      <elseif Spell="Sneak" BuffActive="Sneak" advanced='"%SpellTarget"="%PlayerName" OR "%SpellTarget"="&lt;me&gt;" OR ("%target"="%PlayerName" AND "%SpellTarget"="&lt;t&gt;")'>
        <equip when="midcast" set="Enhancing" />
        <command when="midcast">cancel 71</command>
        <midcastdelay delay="2.3" />
      </elseif>
      <elseif Spell="Stoneskin" BuffActive="Stoneskin">
        <equip when="midcast" set="Enhancing" />
        <command when="midcast">cancel 37</command>
        <midcastdelay delay="5.9" />
      </elseif>
      <elseif Spell="Blink" BuffActive="Blink">
        <equip when="midcast" set="Enhancing" />
        <command when="midcast">cancel 36</command>
        <midcastdelay delay="5.2" />
      </elseif>
      <else>
        <equip when="midcast" set="Enhancing" />
      </else>
    </elseif>
    <!-- Dark Magic-->
    <elseif Skill="DarkMagic">
      <equip when="Midcast" Set="DarkMagic" />
    </elseif>
    <!-- Enfeebling Magic-->
    <elseif Skill="EnfeeblingMagic">
      <equip when="midcast" set="Enfeeb-%Type" />
      <if Spell="Sleep*">
        <command when="aftercast">spellcast var inc sleepid;wait 45;input /echo [$sleepid:%spell] &lt;%Target&gt;Wearing off in 15s</command>
        <command when="aftercast">wait 55;input /echo [$sleepid:%spell] &lt;%Target&gt;Wearing off in 5s;spellcast var dec sleepid;</command>
      </if>
    </elseif>
    <!-- Divine Magic-->
    <elseif Skill="DivineMagic">
      <!-- Light Obi-->
      <if advanced = '("%spellelement" = "%weatherelement" or "%spellelement" = "%dayelement") and "$%spellelementobi" = "1"'>
        <if element = "light">
          <equip when = "midcast">
            <waist lock = "yes">korin obi</waist>
          </equip>
        </if>
      </if>
      <if spell="Banish*|Holy">
        <equip when="Midcast" Set="Banish" />
      </if>
      <else>
        <equip when="Midcast" Set="Divine" />
      </else>
      <!-- Misery active -->
      <if advanced='"$AutoMisery"=="1"'>
        <if spell="Banish" notbuffactive="Afflatus Misery">
          <changespell spell="Afflatus Misery"/>
          <cmd when="aftercast">wait 3;input /ma "Banish"</cmd>
          <changetarget target="&lt;stnpc&gt;" />
        </if>
        <elseif spell="Banish II" notbuffactive="Afflatus Misery">
          <changespell spell="Afflatus Misery"/>
          <cmd when="aftercast">wait 3;input /ma "Banish II"</cmd>
          <changetarget target="&lt;stnpc&gt;" />
        </elseif>
        <if spell="Banish III" notbuffactive="Afflatus Misery">
          <changespell spell="Afflatus Misery"/>
          <cmd when="aftercast">wait 3;input /ma "Banish III"</cmd>
          <changetarget target="&lt;stnpc&gt;" />
        </if>
      </if>
      <!-- Repose Timer-->
      <if Spell="Repose">
        <command when="aftercast">spellcast var inc sleepid;wait 45;input /echo [$sleepid:%spell] &lt;%Target&gt; Wearing off in 45s</command>
        <command when="aftercast">wait 75;input /echo [$sleepid:%spell] &lt;%Target&gt;Wearing off in 15s</command>
        <command when="aftercast">wait 85;input /echo [$sleepid:%spell] &lt;%Target&gt;Wearing off in 5s;spellcast var dec sleepid;</command>
      </if>
      <if advanced = '("%spellelement" = "%weatherelement" or "%spellelement" = "%dayelement") and "$obi%spellelement" = "1"'>
        <if element = "light">
          <equip when = "midcast">
            <waist lock = "yes">korin obi</waist>
          </equip>
        </if>
      </if>
    </elseif>
    <!-- Subjob Rules -->
    <!-- Nin -->
    <if subjob="NIN">
      <if Skill="Ninjutsu">
        <equip when="midcast" set="Haste" />
        <if spell="Utsusemi: Ichi" BuffActive="Copy Image">
          <midcastdelay delay="3.0" />
          <command when="midcast">cancel 66</command>
          <command when="midcast">cancel 445</command>
          <command when="midcast">cancel 446</command>
          <command when="midcast">cancel 444</command>
        </if>
      </if>
    </if>
    <!-- RDM -->
    <elseif subjob="RDM">
      <!-- AutoMacroset-->
      <if advanced='"$AutoMacroset"=="1"'>
        <cmd when="aftercast">input /macro set 1</cmd>
      </if>
      <!-- Convert-->
      <if spell="Convert">
        <cmd when="aftercast">wait 1;input /ma "Cure V" &lt;me&gt;</cmd>
      </if>
      <!-- Auto Refresh -->
      <if advanced='"$AutoRefresh"=="1"'>
        <if notbuffactive="refresh" notspell="Erase|Cur*|*na|Tele*|Recall*|Convert|Divine*|Bene*|Devotion|Martyr|sneak|Invisible|reraise*">
          <changespell spell="refresh"/>
          <changetarget target="&lt;me&gt;" />
        </if>
      </if>
    </elseif>
    <!-- SCH -->
    <elseif subjob="SCH">
      <!-- AutoMacroset-->
      <if advanced='"$AutoMacroset"=="1"'>
        <cmd when="aftercast">input /macro set 2</cmd>
      </if>
      <!-- Light Arts is Active - -10% MP Cost -->
      <if NotBuffActive="Penury">
        <if Spell="Cure V" MPLT="122">
          <changespell Spell="Cure III" />
        </if>
        <elseif Spell="Cure III" MPLT="42">
          <changespell Spell="Cure II" />
        </elseif>
        <elseif Spell="Cure II" MPLT="22">
          <cancelspell />
          <addtochat color="56">I'm Out of MP</addtochat>
        </elseif>
        <elseif spell="Cura II" MPLT="40">
          <changespell Spell="Cura" />
        </elseif>
        <elseif spell="Cura" MPLT="47">
          <changespell Spell="Curaga II" />
        </elseif>
        <elseif spell="Curaga IV" MPLT="130">
          <changespell Spell="Curaga III" />
        </elseif>
        <elseif spell="Curaga III" MPLT="90">
          <changespell Spell="Curaga II" />
        </elseif>
        <elseif spell="Curaga II" MPLT="60">
          <changespell Spell="Curaga" />
        </elseif>
        <elseif spell="Curaga" MPLT="30">
          <cancelspell />
          <addtochat color="121">I'm Out of MP</addtochat>
        </elseif>
      </if>
      <else>
        <!-- Penury is Active - -50% MP Cost -->
        <if Spell="Cure VI" MPLT="68">
          <changespell Spell="Cure V" />
        </if>
        <elseif Spell="Cure V" MPLT="68">
          <changespell Spell="Cure III" />
        </elseif>
        <elseif Spell="Cure III" MPLT="23">
          <changespell Spell="Cure II" />
        </elseif>
        <elseif Spell="Cure II" MPLT="12">
          <cancelspell />
          <addtochat color="56">I'm Out of MP~</addtochat>
        </elseif>
        <elseif spell="Cura II" MPLT="20">
          <changespell Spell="Cura" />
        </elseif>
        <elseif spell="Cura" MPLT="19">
          <changespell Spell="Curaga II" />
        </elseif>
        <elseif spell="Curaga IV" MPLT="117">
          <changespell Spell="Curaga III" />
        </elseif>
        <elseif spell="Curaga III" MPLT="81">
          <changespell Spell="Curaga II" />
        </elseif>
        <elseif spell="Curaga II" MPLT="54">
          <changespell Spell="Curaga" />
        </elseif>
        <elseif spell="Curaga" MPLT="27">
          <cancelspell />
          <addtochat color="121">I'm Out of MP</addtochat>
        </elseif>
      </else>
      <if spell="Accession" notbuffactive="Light Arts">
        <changespell spell="Light Arts"/>
        <cmd when="precast">wait 1;input /ma "Accession"</cmd>
        <changetarget target="&lt;me&gt;"/>
      </if>
      <elseif spell="Penury" notbuffactive="Light Arts">
        <changespell spell="Light Arts"/>
        <cmd when="precast">wait 1;input /ma "Penury"</cmd>
        <changetarget target="&lt;me&gt;"/>
      </elseif>
      <elseif spell="Celerity" notbuffactive="Light Arts">
        <changespell spell="Light Arts"/>
        <cmd when="precast">wait 1;input /ma "Celerity"</cmd>
        <changetarget target="&lt;me&gt;"/>
      </elseif>
    </elseif>
    <!-- SMN -->
    <elseif subjob="SMN">
      <if advanced='"$AutoMacroset"=="1"'>
        <cmd when="aftercast">input /macro set 3</cmd>
      </if>
    </elseif>
    <!-- BLM -->
    <elseif subjob="blm">
      <if advanced='"$AutoMacroset"=="1"'>
        <cmd when="aftercast">input /macro set 4</cmd>
      </if>
    </elseif>
    <elseif subjob="NIN">
      <if advanced='"$AutoMacroset"=="1"'>
        <cmd when="aftercast">input /macro set 5</cmd>
      </if>
    </elseif>
    <!-- WeaponSkill-->
    <if type="Weaponskill">
      <if TPGT="99">
        <if advanced="%SpellTargetDistance &lt; 4">
          <CastDelay Delay=".5"/>
          <equip when="precast" set="%Spell"/>
        </if>
        <else>
          <cancelspell/>
          <addtochat color="121">%SpellTargetName is too far.</addtochat>
          <Return/>
        </else>
      </if>
      <else>
        <cancelspell/>
        <addtochat color="121">You don't have enough TP for that</addtochat>
        <Return/>
      </else>
    </if>
  </rules>
</spellcast>